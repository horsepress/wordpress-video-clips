!function(t,e){"function"==typeof define&&define.amd?define([],e.bind(this,t,t.videojs)):"undefined"!=typeof module&&module.exports?module.exports=e(t,t.videojs):e(t,t.videojs)}(window,function(t,e){"use strict";var n="0.4.0",o=function(o){var r=this,a=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},i=function(t){var e={};return t&&"[object Function]"===e.toString.call(t)},u=function(t){return!!t},f=function(t,e){var n={};return e.forEach(function(e){void 0!==t[e]&&(n[e]=t[e])}),n},c=function(t,n){return n=n||1,e.formatTime(t)+"."+Math.floor(t%1*Math.pow(10,n))},s=function(t,e){var n=Math.pow(10,e);return Math.floor(t*n)/n},l=function(t){if(void 0!==t){if(a(t))return t;if(/^([+\-])?([\d\.]+)$/i.test(t))return parseFloat(t);var e=/^([+\-])?((([\d]+)(h|:(?=.*:)))?(([\d]+)(m|:|$))?)?(([\d\.]+)s?)?$/i.exec(t);if(!e)return null;var n={match:e[0],sign:e[1],hours:e[4]||0,mins:e[7]||0,secs:e[10]||0},o="-"==n.sign?-1:1,r=60*parseFloat(n.hours)*60+60*parseFloat(n.mins)+parseFloat(n.secs);return a(r)?o*r:null}},p={},d={start:{"default":0,validate:function(t){return t===!1?t:a(t)&&t>=0?t:0}},end:{"default":!1,validate:function(t){if(t===!1)return t;if(a(t)){var e=r.duration();if(void 0===e||0===e){if(t>=0)return t}else{if(t>=0&&e>=t)return t;if(t>e)return e}}return!1}},enabled:{"default":!1,validate:u},loopIfBeforeStart:{"default":!0,validate:u},loopIfAfterEnd:{"default":!0,validate:u},pauseBeforeLooping:{"default":!1,validate:u},pauseAfterLooping:{"default":!1,validate:u}},g={onLoopCallBack:{"default":void 0,check:i},onOptionsChange:{"default":void 0,check:i}},h=Object.keys(d),v=Object.keys(g),L=function(){o=o||{};var t=function(t){return function(e){void 0===o[e]&&(o[e]=t[e]["default"])}};h.forEach(t(d)),v.forEach(t(g))},m=function(){v.forEach(function(t){g[t].check(o[t])&&(_[t]=o[t])})},y=function(){return h.forEach(function(t){p[t]=d[t].validate(p[t])}),_},b=function(){return E(o,!0)},E=function(t,e){return h.forEach(function(n){(e||void 0!==t[n])&&(p[n]=t[n])}),y(),_},A=!1,B=function(t){return t?p.pauseBeforeLooping&&A===!1?(r.pause(),A=!0):(A=!1,r.currentTime(p.start),p.pauseAfterLooping&&r.pause(),g.onLoopCallBack.check(_.onLoopCallBack)&&_.onLoopCallBack(_,r)):(A=!1,r.currentTime(p.start)),_},O=function(){return A=!1,r.currentTime(p.end),_},k=function(t){return function(e){return e===!1?p[t]=!1:(void 0!==e&&(e=l(e)),null!==e&&(e=void 0===e?r.currentTime():e,p[t]=e)),_}},T=function(t){return function(e){return e=l(e),a(e)&&(p[t]+=e),_}},P=function(){y(),B(!1),U(),r.play()},U=function(){return p.enabled=!0,_},S=function(){return p.enabled=!1,_},x=function(){var t=p.pauseAfterLooping,e=p.pauseBeforeLooping;return E(t||e?t&&!e?{pauseAfterLooping:!1,pauseBeforeLooping:!0}:!t&&e?{pauseAfterLooping:!0,pauseBeforeLooping:!0}:{pauseAfterLooping:!1,pauseBeforeLooping:!1}:{pauseAfterLooping:!0,pauseBeforeLooping:!1}),_},F=function(t){return function(){return p[t]=!p[t],_}},j=function(e){if(!e.match(/^https?:\/\//)&&t&&t.document){var n=t.document.createElement("div");n.innerHTML='<a href="'+e+'">x</a>',e=n.firstChild.href}return e},C=function(t){return j(K(t))},$=function(t){t=t||{},t.decimalPlaces=Math.floor(t.decimalPlaces)||3;var e=p.start!==!1?parseFloat(p.start):0,n="#t="+s(e,t.decimalPlaces);if(p.end!==!1){var o=parseFloat(p.end);n+=","+s(o,t.decimalPlaces)}return n},K=function(t){t=t||{};var e=r.currentSrc();e.src&&(e=e.src);var n=e+$(t);return n},w=function(t){if("string"==typeof t&&(t=e.parseUrl(t)),t.hash){var n=/^(#?t=)?([^,]*)(,(.*))?$/,o=t.hash.replace(n,"$2"),r=t.hash.replace(n,"$4");o=l(o),r=l(r),a(o)&&(p.start=parseFloat(o)),a(r)&&(p.end=parseFloat(r))}return _},I=function(t){var e=t.replace(/^(.*?)(#.*)?$/,"$1"),n=t.replace(/^(.*?)(#.*)?$/,"$2"),o=r.currentSrc();return o!=e&&o!=t&&t!=n&&r.src(e),n&&w(n),_},M=function(t){var e=t;return"string"==typeof t?e=[t]:void 0!==t&&Array.isArray(t)||(e=null!==t&&"object"==typeof t?Object.keys(t):Object.keys(d)),f(p,e)},N=function(t,e){var n=!e;return e=e||{},h.forEach(function(t){e[t]=!!e[t]||n}),function(){var n=arguments,o=M(),a=t.apply(null,n),i={changed:e,oldOpts:o,newOpts:M()};return _.onOptionsChange&&_.onOptionsChange(i,_,r),Z(e),a}},D=!1,R=function(){var t,e,n;if(y(),t=r.currentTime(),e=H(),n=q(),n>e){if(D=!0,n>t&&t>e&&(1>t-e||p.loopIfAfterEnd||p.loopIfBeforeStart))return!0}else{if(D=!1,n>t&&p.loopIfBeforeStart)return!0;if(t>=e&&(1>t-e||p.loopIfAfterEnd))return!0}return!1},q=function(){return p.start===!1?0:p.start},H=function(){return p.end===!1?r.duration():p.end},V=!1,z=a(o.minLoopLength)&&o.minLoopLength>0?o.minLoopLength:50,G=function(t){!V&&p.enabled&&!r.paused()&&R()&&(V=!0,setTimeout(function(){V=!1},z),B(!0))},J={},Q=[{name:"start",optionsUsed:["start"],leftclick:function(t,e){e.shiftKey?t.adjustStart(-.5):t.setStart()},rightclick:function(t,e){e.shiftKey?t.adjustStart(.5):t.goToStart()},defaultText:"Start",textFunction:function(t){return c(t.start)}},{name:"end",optionsUsed:["end"],leftclick:function(t,e){e.shiftKey?t.adjustEnd(-.5):e.ctrlKey?t.adjustEnd(-.05):t.setEnd()},rightclick:function(t,e){e.shiftKey?t.adjustEnd(.5):e.ctrlKey?t.adjustEnd(.05):t.goToEnd()},defaultText:"End",textFunction:function(t){return c(t.end)}},{name:"enabled",optionsUsed:["enabled","pauseAfterLooping","pauseBeforeLooping"],leftclick:function(t,e){t.toggle()},rightclick:function(e,n){var o;t&&t.prompt&&(n.ctrlKey?o=e.getAbsoluteUrl():n.altKey?o=e.getUrl():n.shiftKey&&(o=e.getUrlFragment())),o?W(o):e.cyclePauseOnLooping()},defaultText:"Loop",textFunction:function(t){return t.enabled?t.pauseBeforeLooping&&t.pauseAfterLooping?"PAUSE LOOP PAUSE":t.pauseAfterLooping?"LOOP& PAUSE":t.pauseBeforeLooping?"PAUSE &LOOP":"LOOP ON":"Loop off"}}],W=function(e){t&&t.prompt&&t.prompt("Copy to clipboard: Ctrl+C, Enter",e)},X=function(t,e){var n=function(t,n){return function(o){(void 0===n||o.which&&o.which==n)&&(t(e.abLoopPlugin,o),this.updateText())}},o=function(t,e){return function(){var n=e(p)||t,o=this.el();o.textContent=n}},r=e.controlBar.addChild("Button");return t.leftclick&&r.on("click",n(t.leftclick)),t.rightclick&&(r.el().onmousedown=n(t.rightclick,3).bind(r),r.on("contextmenu",function(t){return t.preventDefault&&t.preventDefault(),t.preventDefault&&t.stopPropagation(),!1})),r.updateText=o(t.defaultText,t.textFunction),r.optionsUsed=t.optionsUsed,r.addClass("abLoopButton"),r.addClass(t.name),r.updateText(),r},Y=function(t){t.forEach(function(t){void 0===J[t.name]&&(J[t.name]=X(t,r))})},Z=function(t){var e=function(e,n){return e||t[n]};for(var n in J){var o=J[n],r=!o.optionsUsed||o.optionsUsed.reduce(e,!1);r&&o.updateText()}},_={validateOptions:N(y),resetToInitialOptions:N(b),setOptions:N(E),getOptions:M,goToStart:B,goToEnd:O,setStart:N(k("start"),{start:!0}),setEnd:N(k("end"),{end:!0}),adjustStart:N(T("start"),{start:!0}),adjustEnd:N(T("end"),{end:!0}),enable:N(U,{enabled:!0}),disable:N(S,{enabled:!0}),toggle:N(F("enabled"),{enabled:!0}),togglePauseAfterLooping:N(F("pauseAfterLooping"),{pauseAfterLooping:!0}),togglePauseBeforeLooping:N(F("pauseBeforeLooping"),{pauseBeforeLooping:!0}),cyclePauseOnLooping:N(x,{pauseBeforeLooping:!0,pauseAfterLooping:!0}),player:r,version:n,getAbsoluteUrl:C,getUrl:K,getUrlFragment:$,applyUrl:N(I,{start:!0,end:!0}),applyUrlFragment:N(w,{start:!0,end:!0}),loopRequired:R,playLoop:P},tt=function(){L(),m(),N(b)(),r.ready(function(){0!=o.createButtons&&Y(Q),r.on("ended",function(){D&&p.enabled&&!r.loop()&&r.play()})}),r.abLoopPlugin=_,r.on("timeupdate",G),_.loaded=!0};return tt(),_};o.loaded=!1,o.VERSION=n,e.plugin("abLoopPlugin",o)});